# プロンプト管理システム移行計画書 (2025-03-10)

## 1. 移行概要

### 目的
- アプリ名を「bookmarkly」から「prompty」に変更
- フロントエンドの「ブックマーク」表記を「プロンプト」に変更
- タグ関連のデータベースを再構築

### 背景
現在のシステムではタグ機能に関するエラーが多発しており、中間テーブルの設計に問題があると考えられる。また、アプリケーションの目的がプロンプト管理に特化したため、名称変更が必要となった。

## 2. 変更内容詳細

### 2.1 アプリ名変更
- `config/application.rb`のモジュール名を`Prompty`に変更
- ブラウザタイトルなど関連する表示を更新

### 2.2 フロントエンド表記変更
- 「ブックマーク管理」→「プロンプト管理」
- 「新規ブックマーク」→「新規プロンプト」
- その他関連する表示テキストの変更

### 2.3 タグデータベース再構築
- 既存のタグテーブルと中間テーブルを削除
- 新しいタグテーブルを作成（ユーザーIDとの関連付け）
- 中間テーブルの再構築（一意性制約の追加）
- タグモデルの更新（正規化ロジックの改善）

## 3. 移行リスク評価

### 3.1 想定されるリスク
- [ ] データ損失リスク（既存のタグ情報が失われる）
- [ ] 機能停止リスク（移行中のサービス中断）
- [ ] UI/UX一貫性リスク（表記の不統一）

### 3.2 対策
1. **データバックアップ**
   ```bash
   pg_dump -Fc -v -U postgres -d prompty_production > backup_before_tag_migration.dump
   ```

2. **段階的移行**
   - テスト環境での事前検証
   - 低負荷時間帯での実施

3. **ロールバック計画**
   ```bash
   rails db:rollback STEP=2
   # バックアップからの復元（必要な場合）
   ```

## 4. 実施手順

### 4.1 事前準備
- [ ] 完全なデータバックアップの作成
- [ ] メンテナンスモード設定の準備
- [ ] テスト環境での移行テスト実施

### 4.2 移行手順
1. メンテナンスモード開始
2. アプリ名変更の適用
3. フロントエンド表記の変更
4. タグテーブル削除マイグレーション実行
5. 新タグテーブル作成マイグレーション実行
6. モデル更新の適用
7. 動作確認
8. メンテナンスモード解除

### 4.3 検証項目
- [ ] プロンプト一覧表示の確認
- [ ] 新規プロンプト作成の動作確認
- [ ] タグ追加・検索機能の動作確認
- [ ] UI表示の一貫性確認

## 5. スケジュール

| 作業内容 | 予定日時 | 担当者 | 所要時間 |
|---------|---------|-------|---------|
| 事前準備 | 2025-03-10 | 開発チーム | 2時間 |
| テスト環境での検証 | 2025-03-11 | 開発チーム | 4時間 |
| 本番環境での移行 | 2025-03-12 | 開発チーム | 1時間 |
| 移行後検証 | 2025-03-12 | QAチーム | 2時間 |

## 6. 今後の課題

- タグ機能の拡張（階層構造、カラー分け）
- プロンプトテンプレート機能の追加
- パフォーマンス最適化

## 7. 関連資料

- [タグv2システム移行計画書](docs_log/progress_report/tag_migration_plan.md)
- [フロントエンド移行計画](docs_log/progress_report/20250302_frontend_migration.md)
- [バグレポートテンプレート](prompty/docs/progress_report/BUG_REPORT_TEMPLATE.md)

作成日：2025-03-10
更新日：2025-03-10 